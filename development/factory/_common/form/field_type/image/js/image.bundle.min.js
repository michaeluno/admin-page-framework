/*! Admin Page Framework - Image Field Type 0.1.0 */
var apfMain=AdminPageFrameworkScriptFormMain,apfImage=AdminPageFrameworkImageFieldType;apfImage.hasMediaUploader=!!apfImage.hasMediaUploader,function(c){var a,e=["0.1.0",apfImage];parseInt(apfMain.debugMode)&&console.log("APF Image Field Type",...e),c(document).ready(function(){var i;function r(e,t){t=c.extend(!0,{caption:"",alt:"",title:"",url:"",id:"",width:"",height:"",align:"",link:""},t);var a=c("<div/>").text(t.caption).html(),i=c("<div/>").text(t.alt).html(),r=c("<div/>").text(t.title).html();c("input#"+e).val(t.url),c("input#"+e+"_id").val(t.id),c("input#"+e+"_width").val(t.width),c("input#"+e+"_height").val(t.height),c("input#"+e+"_caption").val(a),c("input#"+e+"_alt").val(i),c("input#"+e+"_title").val(r),c("input#"+e+"_align").val(t.align),c("input#"+e+"_link").val(t.link);var n=c("#image_preview_"+e);n.attr("data-id",t.id),n.attr("data-width",t.width),n.attr("data-height",t.height),n.attr("data-caption",a),n.attr("alt",i),n.attr("title",r),n.attr("src",t.url),t.url?c("#image_preview_container_"+e).show():c("#image_preview_container_"+e).hide()}apfImage.hasMediaUploader?a=function(a,i,n){var l,d=!1,e=c("#"+a+'[data-show_preview="1"]');function o(e,t,a){d||c("#"+e).val()!==t.url&&(a=void 0===a?100:a,setTimeout(function(){c("#"+e).trigger("change")},a))}function m(e,t,a){a=void 0===a?100:a,setTimeout(function(){d||r(e,t),d=!1},a)}e.off("change"),e.on("change",function(e){var t=c(this).val();c("<img>",{src:t,error:function(){},load:function(){r(a,{url:t})}})}),(e=c("#select_image_"+a)).off("click"),e.on("click",function(e){var r=c(this).attr("id").substring(13),t=c("#"+r);if(window.wpActiveEditor=null,e.preventDefault(),"object"!=typeof l)return oAdminPageFrameworkOriginalImageUploaderSelectObject=wp.media.view.MediaFrame.Select,wp.media.view.MediaFrame.Select=n?getAdminPageFrameworkCustomMediaUploaderSelectObject():oAdminPageFrameworkOriginalImageUploaderSelectObject,(l=wp.media({id:r,title:n?apfImage.label.insertFromURL:apfImage.label.uploadImage,button:{text:apfImage.label.useThisImage},type:"image",library:{type:t.data("mime_types").length?t.data("mime_types"):"image"},multiple:i,metadata:{}})).on("escape",function(){return!(d=!0)}),l.on("close",function(){var a,e=l.state();if(void 0!==e.props&&void 0!==e.props.attributes){var t,i={};for(t in e.props.attributes)i[t]=e.props.attributes[t]}return void 0!==i?(m(r,i),o(r,i)):l.state().get("selection").each(function(e,t){return e=e.hasOwnProperty("attributes")?e.attributes:{},0===t?(m(r,e),o(r,e),!0):(t=void 0===a?c("#"+r).closest(".admin-page-framework-field"):a,m(t=(a=c(this).addAdminPageFrameworkRepeatableField(t.attr("id"))).find("input").attr("id"),e),void o(t,e))}),wp.media.view.MediaFrame.Select=oAdminPageFrameworkOriginalImageUploaderSelectObject,!1}),l.open(),!1;l.open()})}:(a=function(e,t,a){(e=c("#select_image_"+e)).off("click"),e.on("click",function(){var e=c(this).attr("id");return window.sInputID=e.substring(13),window.original_send_to_editor=window.send_to_editor,window.send_to_editor=i,e=c(this).attr("data-enable_external_source"),tb_show(apfImage.label.uploadImage,"media-upload.php?post_id=1&amp;enable_external_source="+e+"&amp;referrer={$sReferrer}&amp;button_label="+apfImage.label.useThisImage+"&amp;type=image&amp;TB_iframe=true",!1),!1})},i=function(e){var t=c("img",g="<div>"+e+"</div>").attr("src"),a=c("img",g).attr("alt"),i=c("img",g).attr("title"),r=c("img",g).attr("width"),n=c("img",g).attr("height"),l=c("img",g).attr("class"),d=l?l.replace(/(.*?)wp-image-/,""):"",o=e.replace(/\[(\w+).*?\](.*?)\[\/(\w+)\]/m,"$2").replace(/<a.*?>(.*?)<\/a>/m,""),m=e.replace(/^.*?\[\w+.*?\salign=(['"])(.*?)['"]\s.+$/gm,"$2"),p=c(g).find("a:first").attr("href"),o=c("<div/>").text(o).html(),e=c("<div/>").text(a).html(),i=c("<div/>").text(i).html(),g=window.sInputID;c("#"+g).val(t),c("#"+g+"_id").val(d),c("#"+g+"_width").val(r),c("#"+g+"_height").val(n),c("#"+g+"_caption").val(o),c("#"+g+"_alt").val(e),c("#"+g+"_title").val(i),c("#"+g+"_align").val(m),c("#"+g+"_link").val(p),(p=c("#image_preview_"+g)).attr("alt",a),p.attr("title",i),p.attr("data-classes",l),p.attr("data-id",d),p.attr("src",t),c("#image_preview_container_"+g).css("display",""),p.show(),window.send_to_editor=window.original_send_to_editor,tb_remove()}),c().registerAdminPageFrameworkCallbacks({repeated_field:function(e,t){if(1===t.call_type&&e.find("input").first().val()||(e.find(".image_preview").hide(),e.find(".image_preview img").attr("src","")),e.find(".image_preview, .image_preview img, .select_image.button, .remove_image.button").incrementAttributes(["id","data-input_id"],t.incremented_from,t.id),e=(t=e.closest(".admin-page-framework-field")).find(".select_image"),(t=t.find(".image-field input")).length<=0)return!0;a(t.attr("id"),!0,e.attr("data-enable_external_source")),c("#remove_image_"+t.attr("id")+".remove_image.button").on("click",function(e){return r(c(this).data("input_id"),{}),!1})}},apfImage.fieldTypeSlugs),c(".select_image.button").each(function(){a(c(this).data("input_id"),c(this).data("repeatable"),c(this).data("enable_external_source"))}),c(".remove_image.button").on("click",function(e){return r(c(this).data("input_id"),{}),c("#"+c(this).data("input_id")).trigger("change"),!1})})}(jQuery);