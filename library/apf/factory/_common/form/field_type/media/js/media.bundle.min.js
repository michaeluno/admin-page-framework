/*! Admin Page Framework - Media Field Type 0.1.0 */
var apfMain=AdminPageFrameworkScriptFormMain,apfMedia=AdminPageFrameworkMediaFieldType;apfMedia.hasMediaUploader=!!apfMedia.hasMediaUploader,function(l){var i,e=["0.1.0",apfMedia];parseInt(apfMain.debugMode)&&console.log("APF Media Field Type:",...e),l(document).ready(function(){var t;function d(e,a){l("#"+e).val(a.url),l("#"+e+"_id").val(a.id),l("#"+e+"_caption").val(l("<div/>").text(a.caption).html()),l("#"+e+"_description").val(l("<div/>").text(a.description).html())}apfMedia.hasMediaUploader?i=function(e,i,t){var r,n=!1;(e=l("#select_media_"+e)).off("click"),e.on("click",function(e){var d=l(this).attr("id").substring(13),a=l("#"+d);if(window.wpActiveEditor=null,e.preventDefault(),"object"!=typeof r)return oAdminPageFrameworkOriginalMediaUploaderSelectObject=wp.media.view.MediaFrame.Select,wp.media.view.MediaFrame.Select=t?getAdminPageFrameworkCustomMediaUploaderSelectObject():oAdminPageFrameworkOriginalMediaUploaderSelectObject,(r=wp.media({title:t?apfMedia.label.insertFromURL:apfMedia.label.uploadFile,button:{text:apfMedia.label.useThisFile},library:{type:a.data("mime_types").length?a.data("mime_types"):[]},multiple:i,metadata:{}})).on("escape",function(){return!(n=!0)}),r.on("close",function(){var i,e=r.state();if(void 0!==e.props&&void 0!==e.props.attributes){var a,t={};for(a in e.props.attributes)t[a]=e.props.attributes[a]}void 0!==t?o(d,t):r.state().get("selection").each(function(e,a){return e=e.hasOwnProperty("attributes")?e.attributes:{},0===a?(o(d,e),!0):(a=void 0===i?l("#"+d).closest(".admin-page-framework-field"):i,a=(i=l(this).addAdminPageFrameworkRepeatableField(a.attr("id"))).find("input").attr("id"),void o(a,e))}),wp.media.view.MediaFrame.Select=oAdminPageFrameworkOriginalMediaUploaderSelectObject}),r.open(),!1;r.open()});var o=function(e,a,i){i=void 0===i?100:i,setTimeout(function(){n||d(e,a),n=!1},i)}}:(i=function(e,a,i){(e=l("#select_media_"+e)).off("click"),e.on("click",function(){var e=l(this).attr("id");return window.sInputID=e.substring(13),window.original_send_to_editor=window.send_to_editor,window.send_to_editor=t,e=l(this).attr("data-enable_external_source"),tb_show(apfMedia.label.uploadFile,"media-upload.php?post_id=1&amp;enable_external_source="+e+"&amp;referrer="+apfMedia.referer+"&amp;button_label="+apfMedia.label.useThisFile+"&amp;type=image&amp;TB_iframe=true",!1),!1})},t=function(e,a){var i=l("a",t="<div>"+e+"</div>").attr("href"),t=(e=l("a",t).attr("class"))?e.replace(/(.*?)wp-image-/,""):"",e=window.sInputID;l("#"+e).val(i),l("#"+e+"_id").val(t),window.send_to_editor=window.original_send_to_editor,tb_remove()}),l(document).ready(function(){l("a.select_media.button").each(function(){i(l(this).data("input_id"),l(this).data("repeatable"),l(this).data("enable_external_source"))}),l("a.remove_media.button").on("click",function(){return d(l(this).data("input_id"),{}),!1}),l().registerAdminPageFrameworkCallbacks({repeated_field:function(e,a){if(e.find(".select_media.button, .remove_media.button").incrementAttributes(["id","data-input_id"],a.incremented_from,a.id),(a=e.find(".media-field input")).length<=0)return!0;i(a.attr("id"),!0,e.find(".select_media").attr("data-enable_external_source")),l("#remove_media_"+a.attr("id")).on("click",function(){return d(l(this).data("input_id"),{}),!1})}},apfMedia.fieldTypeSlugs)})})}(jQuery);